import mongoose from 'mongoose';

const vulnerabilityTestSchema = new mongoose.Schema({
  url: {
    type: String,
    required: true
  },
  userId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'AdminUser',
    required: true
  },
  testType: {
    type: String,
    required: true,
    enum: [
      'cors',
      'ssl_tls',
      'data_exposure',
      'access_control',
      'rate_limiting',
      'sql_injection',
      'xss',
      'nosql_injection',
      'command_injection',
      'security_headers',
      'authentication'
    ]
  },
  status: {
    type: String,
    enum: ['passed', 'failed', 'error'],
    required: true
  },
  severity: {
    type: String,
    enum: ['critical', 'high', 'medium', 'low', 'info'],
    default: 'info'
  },
  findings: [{
    description: String,
    evidence: String,
    remediation: String,
    cwe: String,
    owasp: String
  }],
  metadata: {
    responseTime: Number,
    statusCode: Number,
    testPayload: String
  }
}, {
  timestamps: true
});

vulnerabilityTestSchema.index({ userId: 1, createdAt: -1 });
vulnerabilityTestSchema.index({ url: 1, testType: 1 });
vulnerabilityTestSchema.index({ status: 1, severity: 1 });

export default mongoose.model('VulnerabilityTest', vulnerabilityTestSchema);
